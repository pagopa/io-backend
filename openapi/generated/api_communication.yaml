openapi: 3.0.2
info:
  version: 18.6.0
  title: IO Communication API
  description: |
    API for managing user messages, notifications and payment information.
servers:
  - url: https://localhost/api/communication/v1
security:
  - Bearer: []
paths:
  /messages:
    get:
      operationId: getUserMessages
      summary: Get user's messages
      description: >-
        Returns the messages for the user identified by the provided fiscal
        code.

        Messages will be returned in inverse acceptance order (from last to
        first).

        The "next" field, when present, contains an URL pointing to the next
        page of results.
      parameters:
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/EnrichResultData'
        - $ref: '#/components/parameters/GetArchivedMessages'
        - $ref: '#/components/parameters/MaximumId'
        - $ref: '#/components/parameters/MinimumId'
      responses:
        '200':
          description: Found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPublicMessagesCollection'
              example:
                items:
                  - created_at: '2018-05-21T07:36:41.209Z'
                    fiscal_code: LSSLCU79B24L219P
                    id: 01CE0T1Z18T3NT9ECK5NJ09YR3
                    sender_service_id: 5a563817fcc896087002ea46c49a
                    time_to_live: 3600
                  - created_at: '2018-05-21T07:41:01.361Z'
                    fiscal_code: LSSLCU79B24L219P
                    id: 01CE0T9X1HT595GEF8FH9NRSW7
                    sender_service_id: 5a563817fcc896087002ea46c49a
                    time_to_live: 3600
                next: 01CE0T9X1HT595GEF8FH9NRSW7
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '404':
          description: No message found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: There was an error in retrieving the messages.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
  /messages/{id}:
    get:
      operationId: getUserMessage
      summary: Get message
      description: Returns the message with the provided message ID.
      parameters:
        - $ref: '#/components/parameters/MessageId'
        - $ref: '#/components/parameters/PublicMessage'
      responses:
        '200':
          description: Found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreatedMessageWithContentAndAttachments'
              example:
                content:
                  markdown: >-
                    hey hey !! <a style="color: red" href="http://example.com">
                    some content here ..... this is a link with a style applied,
                    some other content</a>
                  subject: my subject ............
                  attachments:
                    - name: attachment
                      content: aBase64Encoding
                      mime_type: image/png
                created_at: '2018-06-06T12:22:24.523Z'
                fiscal_code: LSSLCU79B24L219P
                id: 01CFAGRMGB9XCA8B2CQ4QA7K76
                sender_service_id: 5a25abf4fcc89605c082f042c49a
                time_to_live: 3600
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '404':
          description: No message found for the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: There was an error in retrieving the message.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
  /messages/{id}/status:
    put:
      operationId: upsertMessageStatusAttributes
      summary: UpsertMessageStatusAttributes
      description: Updates the status of a message with attributes
      parameters:
        - $ref: '#/components/parameters/MessageId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageStatusChange'
            example:
              change_type: bulk
              is_archived: true
              is_read: true
      responses:
        '200':
          description: Success.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageStatusAttributes'
              example:
                is_read: true
                is_archived: false
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '403':
          description: Operation forbidden.
        '404':
          description: No message found for the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: There was an error in upserting message's status attributes.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
  /third-party-messages/{id}/precondition:
    get:
      operationId: getThirdPartyMessagePrecondition
      summary: Retrieve third party message precondition
      description: >-
        Returns the precondition associated to the provided message ID to
        receive the third party message.
      parameters:
        - $ref: '#/components/parameters/MessageId'
      responses:
        '200':
          description: Found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThirdPartyMessagePrecondition'
              example:
                title: Questo messaggio contiene una comunicazione a valore legale
                markdown: >-
                  Se continui, la notifica risulterÃ  legalmente recapitata a te.
                  Aprire il messaggio su IO equivale infatti a firmare la
                  ricevuta di ritorno di una raccomandata tradizionale.

                  **Mittente**: Comune di Xxxxxxx  

                  **Oggetto**: Infrazione al codice della strada  

                  **Data e ora**: 12 Luglio 2022 - 12.36  

                  **Codice IUN**: YYYYMM-1-ABCD-EFGH-X
        '204':
          description: Pre conditions not needed
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '403':
          description: Forbidden
        '404':
          description: No message found for the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '410':
          description: Third Party Service no longer available
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: There was an error in retrieving the message.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '501':
          description: Not Implemented
        '504':
          description: Gateway Timeout
  /third-party-messages/{id}:
    get:
      operationId: getThirdPartyMessage
      summary: Retrieve third party message
      description: Returns the third party message with the provided message ID.
      parameters:
        - $ref: '#/components/parameters/MessageId'
      responses:
        '200':
          description: Found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThirdPartyMessageWithContent'
              example:
                content:
                  markdown: >-
                    hey hey !! <a style="color: red" href="http://example.com">
                    some content here ..... this is a link with a style applied,
                    some other content</a>
                  subject: my subject ............
                  third_party_data:
                    - id: aThirdPartyMessageId
                third_party_message:
                  attachments: []
                  custom_property: a custom property
                created_at: '2018-06-06T12:22:24.523Z'
                fiscal_code: LSSLCU79B24L219P
                id: 01CFAGRMGB9XCA8B2CQ4QA7K76
                sender_service_id: 5a25abf4fcc89605c082f042c49a
                time_to_live: 3600
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '403':
          description: Forbidden
        '404':
          description: No message found for the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '410':
          description: Third Party Service no longer available
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '500':
          description: There was an error in retrieving the message.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '501':
          description: Not Implemented
        '502':
          description: Bad Gateway
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '504':
          description: Gateway Timeout
  /third-party-messages/{id}/attachments/{attachment_url}:
    get:
      operationId: getThirdPartyMessageAttachment
      summary: Retrieve an attachment of a third party message
      parameters:
        - $ref: '#/components/parameters/MessageId'
        - name: attachment_url
          in: path
          required: true
          schema:
            type: string
            minLength: 1
      responses:
        '200':
          description: Success
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: No message found for the provided ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '410':
          description: Third Party Service no longer available
        '415':
          description: Unsupported Media TYPE - File Format Validation Error
        '429':
          description: Too Many Requests
        '500':
          description: Internal Server Error
        '501':
          description: Not Implemented
        '504':
          description: Gateway Timeout
  /send/activation:
    get:
      operationId: getSendActivation
      summary: Get SEND Activation
      description: >
        Get the service activation status for Special Service "Avvisi di
        Cortesia"
      parameters:
        - name: isTest
          in: query
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Request created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SendActivation'
        '401':
          description: Bearer token null or expired.
        '429':
          description: Too many requests
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
    post:
      operationId: upsertSendActivation
      summary: Upsert SEND Activation
      description: >
        Upsert the service activation status for Special Service "Avvisi di
        Cortesia"
      parameters:
        - name: isTest
          in: query
          required: false
          schema:
            type: boolean
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendActivation'
            example:
              activation_status: true
      responses:
        '204':
          description: Request created.
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '401':
          description: Bearer token null or expired.
        '429':
          description: Too many requests
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
  /installations/{installationID}:
    put:
      operationId: createOrUpdateInstallation
      summary: Create or update an Installation
      description: Create or update an Installation to the Azure Notification hub.
      parameters:
        - name: installationID
          in: path
          required: true
          description: The ID of the installation.
          schema:
            $ref: '#/components/schemas/InstallationID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Installation'
            example:
              platform: gcm
              pushChannel: push-notification-service-handle
      responses:
        '200':
          description: Success.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                message: ok
        '401':
          description: Bearer token null or expired.
        '500':
          description: >-
            There was an error in registering the device to the Notification
            Hub.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
  /payment/info/{rptId}:
    get:
      operationId: getPaymentInfoV2
      summary: Get Payment Info
      description: Retrieve information about a payment
      parameters:
        - name: rptId
          in: path
          required: true
          description: Unique identifier for payments.
          schema:
            type: string
        - name: test
          in: query
          description: Use test environment of PagoPAEcommerceClient
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Payment information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInfoResponse'
              example:
                amount: 11400
                description: PAGAMENTO TARI PRIMA RATA
                dueDate: '2025-05-31'
        '401':
          description: Bearer token null or expired.
        '404':
          description: This error occurs when submitting a non-existing RPT id.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInfoNotFoundResponse'
        '409':
          description: Conflict on payment status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInfoConflictResponse'
        '500':
          description: Unauthorized, access token missing or invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProblemJson'
        '502':
          description: PagoPA services are not available or request is rejected by PagoPa
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentInfoBadGatewayResponse'
        '503':
          description: EC services are not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PartyConfigurationFaultPaymentProblemJson'
components:
  parameters:
    MessageId:
      name: id
      in: path
      required: true
      description: The message id in ulid format
      schema:
        type: string
        maxLength: 26
        minLength: 26
        pattern: '[0-9a-hjkmnp-tv-zA-HJKMNP-TV-Z]{26}'
      example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
    PublicMessage:
      name: public_message
      in: query
      description: Discriminate when to return public message shape. Default to false.
      schema:
        type: boolean
    EnrichResultData:
      name: enrich_result_data
      in: query
      required: false
      description: Indicates whether result data should be enriched or not.
      schema:
        type: boolean
    GetArchivedMessages:
      name: archived
      in: query
      required: false
      description: >-
        Indicates whether retrieve archived/not archived messages. Default is
        false
      schema:
        type: boolean
    PageSize:
      name: page_size
      in: query
      required: false
      description: How many items a page should include.
      schema:
        type: integer
        minimum: 1
        maximum: 100
    MaximumId:
      name: maximum_id
      in: query
      required: false
      description: The maximum id to get messages until to.
      schema:
        type: string
        maxLength: 26
        minLength: 26
        pattern: '[0-9a-hjkmnp-tv-zA-HJKMNP-TV-Z]{26}'
      example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
    MinimumId:
      name: minimum_id
      in: query
      required: false
      description: The minimum id to get messages from.
      schema:
        type: string
        maxLength: 26
        minLength: 26
        pattern: '[0-9a-hjkmnp-tv-zA-HJKMNP-TV-Z]{26}'
      example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
  schemas:
    FiscalCode:
      type: string
      description: User's fiscal code.
      format: FiscalCode
      x-import: '@pagopa/ts-commons/lib/strings'
      example: SPNDNL80R13C555X
    OrganizationFiscalCode:
      type: string
      description: Organization fiscal code.
      format: OrganizationFiscalCode
      x-import: '@pagopa/ts-commons/lib/strings'
      example: '12345678901'
    Timestamp:
      type: string
      format: UTCISODateFromString
      description: A date-time field in ISO-8601 format and UTC timezone.
      x-import: '@pagopa/ts-commons/lib/dates'
      example: '2018-10-13T00:00:00.000Z'
    TimeToLiveSeconds:
      type: integer
      default: 3600
      minimum: 3600
      maximum: 604800
      description: |-
        This parameter specifies for how long (in seconds) the system will
        try to deliver the message to the channels configured by the user.
      example: 3600
    ProblemJson:
      type: object
      properties:
        type:
          type: string
          format: uri
          description: |-
            An absolute URI that identifies the problem type. When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: about:blank
          example: https://example.com/problem/constraint-violation
        title:
          type: string
          description: >-
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        status:
          type: integer
          format: int32
          description: >-
            The HTTP status code generated by the origin server for this
            occurrence of the problem.
          minimum: 100
          maximum: 600
          exclusiveMaximum: true
          example: 200
        detail:
          type: string
          description: |-
            A human readable explanation specific to this occurrence of the
            problem.
          example: There was an error processing the request
        instance:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the specific occurrence of the
            problem.

            It may or may not yield further information if dereferenced.
    PublicMessage:
      x-one-of: true
      allOf:
        - $ref: '#/components/schemas/EnrichedMessage'
        - $ref: '#/components/schemas/CreatedMessageWithoutContent'
    PaginationResponse:
      type: object
      description: Pagination response parameters.
      properties:
        prev:
          type: string
          description: Contains a value useful to get the previous page
          example: first_id_of_the_page
        next:
          type: string
          description: Contains a value useful to get the next page
          example: last_id_of_the_page
    PublicMessagesCollection:
      description: A collection of messages
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PublicMessage'
      required:
        - items
    PaginatedPublicMessagesCollection:
      description: A paginated collection of messages
      allOf:
        - $ref: '#/components/schemas/PublicMessagesCollection'
        - $ref: '#/components/schemas/PaginationResponse'
    EnrichedMessage:
      allOf:
        - $ref: '#/components/schemas/BaseEnrichedMessage'
        - $ref: '#/components/schemas/MessageStatusAttributes'
    BaseEnrichedMessage:
      type: object
      properties:
        id:
          type: string
        fiscal_code:
          $ref: '#/components/schemas/FiscalCode'
        time_to_live:
          $ref: '#/components/schemas/TimeToLiveSeconds'
        created_at:
          $ref: '#/components/schemas/Timestamp'
        sender_service_id:
          $ref: '#/components/schemas/ServiceId'
        service_name:
          type: string
        organization_name:
          type: string
        organization_fiscal_code:
          $ref: '#/components/schemas/OrganizationFiscalCode'
        message_title:
          type: string
        category:
          $ref: '#/components/schemas/MessageCategory'
        has_attachments:
          type: boolean
          default: false
        has_precondition:
          type: boolean
          default: false
      required:
        - id
        - fiscal_code
        - created_at
        - sender_service_id
        - service_name
        - organization_name
        - organization_fiscal_code
        - message_title
    MessageStatusAttributes:
      type: object
      properties:
        is_read:
          type: boolean
          default: false
        is_archived:
          type: boolean
          default: false
      required:
        - is_read
        - is_archived
    CreatedMessageWithoutContent:
      type: object
      properties:
        id:
          type: string
        fiscal_code:
          $ref: '#/components/schemas/FiscalCode'
        time_to_live:
          $ref: '#/components/schemas/TimeToLiveSeconds'
        created_at:
          $ref: '#/components/schemas/Timestamp'
        sender_service_id:
          $ref: '#/components/schemas/ServiceId'
      required:
        - id
        - fiscal_code
        - created_at
        - sender_service_id
    CreatedMessageWithoutContentCollection:
      description: A collection of messages
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/CreatedMessageWithoutContent'
      required:
        - items
    NewMessageContent:
      allOf:
        - $ref: '#/components/schemas/MessageContentBase'
        - type: object
          properties:
            payment_data:
              $ref: '#/components/schemas/PaymentDataWithRequiredPayee'
            due_date:
              $ref: '#/components/schemas/Timestamp'
            prescription_data:
              $ref: '#/components/schemas/PrescriptionData'
            eu_covid_cert:
              $ref: '#/components/schemas/EUCovidCert'
            third_party_data:
              $ref: '#/components/schemas/ThirdPartyData'
            legal_data:
              $ref: '#/components/schemas/LegalData'
    MessageContentBase:
      type: object
      properties:
        subject:
          $ref: '#/components/schemas/MessageSubject'
        markdown:
          $ref: '#/components/schemas/MessageBodyMarkdown'
        require_secure_channels:
          type: boolean
          description: When true, messages won't trigger email notifications (only push).
      required:
        - subject
        - markdown
    MessageBodyMarkdown:
      type: string
      description: |-
        The full version of the message, in plain text or Markdown format. The
        content of this field will be delivered to channels that don't have any
        limit in terms of content size (e.g. email, etc...).
      minLength: 80
      maxLength: 10000
      example: |-
        # This is a markdown header

        to show how easily markdown can be converted to **HTML**

        Remember: this has to be a long text.
    MessageSubject:
      type: string
      description: >-
        The subject of the message - note that only some notification

        channels support the display of a subject. When a subject is not
        provided,

        one gets generated from the client attributes.
      minLength: 10
      maxLength: 120
      example: Welcome new user !
    EUCovidCert:
      type: object
      description: Paylod with access token to retrieve a EU Covid Certificate
      properties:
        auth_code:
          type: string
      required:
        - auth_code
    Payee:
      type: object
      description: Metadata needed to explicit payment's payee.
      properties:
        fiscal_code:
          $ref: '#/components/schemas/OrganizationFiscalCode'
      required:
        - fiscal_code
    PaymentDataBase:
      type: object
      description: Metadata needed to process pagoPA payments.
      properties:
        amount:
          $ref: '#/components/schemas/PaymentAmount'
        notice_number:
          $ref: '#/components/schemas/PaymentNoticeNumber'
        invalid_after_due_date:
          type: boolean
          default: false
      required:
        - amount
        - notice_number
    PaymentDataWithRequiredPayee:
      allOf:
        - $ref: '#/components/schemas/PaymentDataBase'
        - type: object
          properties:
            payee:
              $ref: '#/components/schemas/Payee'
          required:
            - payee
    CreatedMessageWithContentResponse:
      x-one-of: true
      allOf:
        - $ref: '#/components/schemas/CreatedMessageWithContent'
        - $ref: '#/components/schemas/CreatedMessageWithContentAndEnrichedData'
    CreatedMessageWithContentAndEnrichedData:
      allOf:
        - $ref: '#/components/schemas/CreatedMessageWithContent'
        - $ref: '#/components/schemas/EnrichedMessage'
    CreatedMessageWithContent:
      type: object
      properties:
        id:
          type: string
        fiscal_code:
          $ref: '#/components/schemas/FiscalCode'
        time_to_live:
          $ref: '#/components/schemas/TimeToLiveSeconds'
        created_at:
          $ref: '#/components/schemas/Timestamp'
        content:
          $ref: '#/components/schemas/NewMessageContent'
        sender_service_id:
          $ref: '#/components/schemas/ServiceId'
      required:
        - id
        - fiscal_code
        - created_at
        - content
        - sender_service_id
    PrescriptionData:
      type: object
      description: Metadata needed to process medical prescriptions.
      properties:
        nre:
          description: >-
            The field *Numero ricetta elettronica* identifies the medical
            prescription at national level.
          type: string
          minLength: 15
          maxLength: 15
        iup:
          description: >-
            The field *Identificativo Unico di Prescrizione* identifies the
            medical prescription at regional level.
          type: string
          minLength: 1
          maxLength: 16
        prescriber_fiscal_code:
          type: string
          description: Fiscal code of the Doctor that made the prescription.
          format: FiscalCode
          x-import: '@pagopa/ts-commons/lib/strings'
          example: TCNZRO80R13C555Y
      required:
        - nre
    ThirdPartyData:
      type: object
      description: >-
        Payload containing all information needed to retrieve and visualize
        third party message details
      properties:
        id:
          type: string
          description: >-
            Unique id for retrieving third party enriched information about the
            message
          minLength: 1
        original_sender:
          type: string
          description: Either a ServiceId or a simple string representing the sender name
          minLength: 1
        original_receipt_date:
          $ref: '#/components/schemas/Timestamp'
        has_attachments:
          type: boolean
          default: false
        has_remote_content:
          type: boolean
          default: false
        has_precondition:
          $ref: '#/components/schemas/HasPrecondition'
        summary:
          type: string
          minLength: 1
        configuration_id:
          $ref: '#/components/schemas/Ulid'
      required:
        - id
    HasPrecondition:
      type: string
      x-extensible-enum:
        - ALWAYS
        - ONCE
        - NEVER
    Ulid:
      type: string
      description: Ulid string.
      format: Ulid
      x-import: '@pagopa/ts-commons/lib/strings'
      example: 01ARZ3NDEKTSV4RRFFQ69G5FAV
    LegalData:
      type: object
      properties:
        sender_mail_from:
          type: string
          minLength: 1
        has_attachment:
          type: boolean
          default: false
        message_unique_id:
          type: string
          minLength: 1
        original_message_url:
          type: string
          minLength: 1
        pec_server_service_id:
          $ref: '#/components/schemas/ServiceId'
      required:
        - sender_mail_from
        - has_attachment
        - message_unique_id
    ServiceId:
      type: string
      description: |-
        The ID of the Service. Equals the subscriptionId of a registered
        API user.
      minLength: 1
    MessageStatusReadingChange:
      type: object
      properties:
        change_type:
          type: string
          enum:
            - reading
        is_read:
          type: boolean
          enum:
            - true
      required:
        - change_type
        - is_read
    MessageStatusArchivingChange:
      type: object
      properties:
        change_type:
          type: string
          enum:
            - archiving
        is_archived:
          type: boolean
      required:
        - change_type
        - is_archived
    MessageStatusBulkChange:
      type: object
      properties:
        change_type:
          type: string
          enum:
            - bulk
        is_archived:
          type: boolean
        is_read:
          type: boolean
          enum:
            - true
      required:
        - change_type
        - is_archived
    MessageStatusChange:
      x-one-of: true
      allOf:
        - $ref: '#/components/schemas/MessageStatusReadingChange'
        - $ref: '#/components/schemas/MessageStatusArchivingChange'
        - $ref: '#/components/schemas/MessageStatusBulkChange'
    ThirdPartyMessageWithContent:
      allOf:
        - $ref: '#/components/schemas/CreatedMessageWithContent'
        - type: object
          properties:
            third_party_message:
              $ref: '#/components/schemas/ThirdPartyMessage'
          required:
            - third_party_message
    ThirdPartyMessage:
      type: object
      properties:
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/ThirdPartyAttachment'
        details:
          type: object
          additionalProperties: true
    ThirdPartyAttachment:
      type: object
      properties:
        id:
          type: string
          minLength: 1
        content_type:
          type: string
          minLength: 1
        name:
          type: string
          minLength: 1
        url:
          type: string
          minLength: 1
        category:
          type: string
          default: DOCUMENT
      required:
        - id
        - url
    ThirdPartyMessagePrecondition:
      type: object
      title: ThirdPartyMessagePrecondition
      description: Describes a message precondition
      properties:
        title:
          type: string
        markdown:
          type: string
      required:
        - title
        - markdown
    MessageCategory:
      x-one-of: true
      allOf:
        - $ref: '#/components/schemas/MessageCategoryPayment'
        - $ref: '#/components/schemas/MessageCategoryBase'
        - $ref: '#/components/schemas/MessageCategoryPN'
    MessageCategoryBase:
      type: object
      properties:
        tag:
          type: string
          enum:
            - LEGAL_MESSAGE
            - EU_COVID_CERT
            - GENERIC
      required:
        - tag
    MessageCategoryPayment:
      type: object
      properties:
        tag:
          type: string
          enum:
            - PAYMENT
        rptId:
          type: string
      required:
        - tag
        - rptId
    MessageCategoryPN:
      allOf:
        - $ref: '#/components/schemas/ThirdPartyData'
        - type: object
          properties:
            tag:
              type: string
              enum:
                - PN
          required:
            - tag
    PaymentAmount:
      description: >-
        Amount of payment in euro cent. PagoPA accepts up to 9999999999 euro
        cents.
      type: integer
      minimum: 1
      maximum: 9999999999
    PaymentNoticeNumber:
      description: >-
        The field "Numero Avviso" of pagoPa, needed to identify the payment.
        Format is `<aux digit(1n)>[<application code> (2n)]<codice IUV
        (15|17n)>`. See [pagoPa
        specs](https://docs.pagopa.it/saci/specifiche-attuative-dei-codici-identificativi-di-versamento-riversamento-e-rendicontazione/premessa)
        for more info on this field and the IUV.
      type: string
      pattern: ^[0123][0-9]{17}$
    MessageContentWithAttachments:
      allOf:
        - type: object
          properties:
            attachments:
              type: array
              items:
                $ref: '#/components/schemas/MessageAttachment'
        - $ref: '#/components/schemas/NewMessageContent'
    MessageAttachment:
      type: object
      title: MessageAttachment
      description: Describes a message's attachment
      properties:
        name:
          type: string
        content:
          type: string
        mime_type:
          type: string
      required:
        - name
        - content
        - mime_type
    CreatedMessageWithContentAndAttachments:
      allOf:
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/MessageContentWithAttachments'
          required:
            - content
        - $ref: '#/components/schemas/CreatedMessageWithContentResponse'
    Installation:
      type: object
      title: Installation
      description: Describes an app installation.
      properties:
        platform:
          $ref: '#/components/schemas/Platform'
        pushChannel:
          $ref: '#/components/schemas/PushChannel'
      required:
        - platform
        - pushChannel
    Platform:
      type: string
      description: The platform type where the installation happened.
      enum:
        - apns
        - gcm
    PushChannel:
      type: string
      description: >-
        The Push Notification Service handle for this Installation.

        See
        https://docs.microsoft.com/en-us/azure/notification-hubs/notification-hubs-push-notification-registration-management
    SuccessResponse:
      type: object
      properties:
        message:
          type: string
    PaymentInfoResponse:
      title: PaymentRequestsGetResponse
      required:
        - amount
      type: object
      properties:
        rptId:
          pattern: ([a-zA-Z\d]{1,35})|(RF\d{2}[a-zA-Z\d]{1,21})
          type: string
          description: Digital payment request id
        paFiscalCode:
          maxLength: 11
          minLength: 11
          type: string
          description: Fiscal code associated to the payment notice
        paName:
          maxLength: 140
          minLength: 1
          type: string
          description: Name of the payment notice issuer
        description:
          maxLength: 140
          minLength: 1
          type: string
          description: Payment notice description
        amount:
          maximum: 99999999
          minimum: 0
          type: integer
          description: Payment notice amount
        dueDate:
          pattern: ([0-9]{4})-(1[0-2]|0[1-9])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])
          type: string
          description: Payment notice due date
          example: '2025-07-31'
      description: Response with payment request information
    ValidationFaultPaymentUnknown:
      type: string
      description: >
        Fault codes for errors related to well-formed requests to ECs not
        present inside Nodo, should be mapped to 404 HTTP status code.

        Most of the time these are generated when users input a wrong fiscal
        code or notice number.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PAA_PAGAMENTO_SCONOSCIUTO`
      enum:
        - PAA_PAGAMENTO_SCONOSCIUTO
    ValidationFaultPaymentUnavailable:
      type: string
      description: >
        Fault codes for errors related to well-formed requests to ECs not
        present inside Nodo, should be mapped to 404 HTTP status code.

        Most of the time these are generated when users input a wrong fiscal
        code or notice number.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PPT_PSP_SCONOSCIUTO`

        - `PPT_PSP_DISABILITATO`

        - `PPT_INTERMEDIARIO_PSP_SCONOSCIUTO`

        - `PPT_INTERMEDIARIO_PSP_DISABILITATO`

        - `PPT_CANALE_SCONOSCIUTO`

        - `PPT_CANALE_DISABILITATO`

        - `PPT_AUTENTICAZIONE`

        - `PPT_AUTORIZZAZIONE`

        - `PPT_DOMINIO_DISABILITATO`

        - `PPT_INTERMEDIARIO_PA_DISABILITATO`

        - `PPT_STAZIONE_INT_PA_DISABILITATA`

        - `PPT_CODIFICA_PSP_SCONOSCIUTA`

        - `PPT_SEMANTICA`

        - `PPT_SYSTEM_ERROR`

        - `PAA_SEMANTICA`
      enum:
        - PPT_PSP_SCONOSCIUTO
        - PPT_PSP_DISABILITATO
        - PPT_INTERMEDIARIO_PSP_SCONOSCIUTO
        - PPT_INTERMEDIARIO_PSP_DISABILITATO
        - PPT_CANALE_SCONOSCIUTO
        - PPT_CANALE_DISABILITATO
        - PPT_AUTENTICAZIONE
        - PPT_AUTORIZZAZIONE
        - PPT_DOMINIO_DISABILITATO
        - PPT_INTERMEDIARIO_PA_DISABILITATO
        - PPT_STAZIONE_INT_PA_DISABILITATA
        - PPT_CODIFICA_PSP_SCONOSCIUTA
        - PPT_SEMANTICA
        - PPT_SYSTEM_ERROR
        - PAA_SEMANTICA
    ValidationFaultPaymentDataError:
      type: string
      description: >
        Fault codes for errors related to well-formed requests to ECs not
        present inside Nodo, should be mapped to 404 HTTP status code.

        Most of the time these are generated when users input a wrong fiscal
        code or notice number.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PPT_SINTASSI_EXTRAXSD`

        - `PPT_SINTASSI_XSD`

        - `PPT_DOMINIO_SCONOSCIUTO`

        - `PPT_STAZIONE_INT_PA_SCONOSCIUTA`
      enum:
        - PPT_SINTASSI_EXTRAXSD
        - PPT_SINTASSI_XSD
        - PPT_DOMINIO_SCONOSCIUTO
        - PPT_STAZIONE_INT_PA_SCONOSCIUTA
    PaymentOngoingStatusFault:
      type: string
      description: >
        Fault codes for errors related to payment attempts that cause conflict
        with the current payment status,

        such as a duplicated payment attempt or a payment attempt made while
        another attempt is still being processed.

        Should be mapped to 409 HTTP status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PPT_PAGAMENTO_IN_CORSO`

        - `PAA_PAGAMENTO_IN_CORSO`
      enum:
        - PPT_PAGAMENTO_IN_CORSO
        - PAA_PAGAMENTO_IN_CORSO
    PaymentExpiredStatusFault:
      type: string
      description: >
        Fault codes for errors related to payment attempts that cause conflict
        with the current payment status,

        such as a duplicated payment attempt or a payment attempt made while
        another attempt is still being processed.

        Should be mapped to 409 HTTP status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PAA_PAGAMENTO_SCADUTO`
      enum:
        - PAA_PAGAMENTO_SCADUTO
    PaymentCanceledStatusFault:
      type: string
      description: >
        Fault codes for errors related to payment attempts that cause conflict
        with the current payment status,

        such as a duplicated payment attempt or a payment attempt made while
        another attempt is still being processed.

        Should be mapped to 409 HTTP status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PAA_PAGAMENTO_ANNULLATO`
      enum:
        - PAA_PAGAMENTO_ANNULLATO
    PaymentDuplicatedStatusFault:
      type: string
      description: >
        Fault codes for errors related to payment attempts that cause conflict
        with the current payment status,

        such as a duplicated payment attempt or a payment attempt made while
        another attempt is still being processed.

        Should be mapped to 409 HTTP status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PAA_PAGAMENTO_DUPLICATO`

        - `PPT_PAGAMENTO_DUPLICATO`
      enum:
        - PAA_PAGAMENTO_DUPLICATO
        - PPT_PAGAMENTO_DUPLICATO
    GatewayFault:
      type: string
      description: >
        Fault codes for generic downstream services errors, should be mapped to
        502 HTTP status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.
    PartyConfigurationFault:
      type: string
      description: >
        Fault codes for fatal errors from ECs, should be mapped to 503 HTTP
        status code.

        For further information visit
        https://docs.pagopa.it/gestionedeglierrori/struttura-degli-errori/fault-code.

        Possible fault codes are:

        - `PPT_STAZIONE_INT_PA_IRRAGGIUNGIBILE`

        - `PPT_STAZIONE_INT_PA_TIMEOUT`

        - `PPT_STAZIONE_INT_PA_ERRORE_RESPONSE`

        - `PPT_IBAN_NON_CENSITO`

        - `PAA_SINTASSI_EXTRAXSD`

        - `PAA_SINTASSI_XSD`

        - `PAA_ID_DOMINIO_ERRATO`

        - `PAA_ID_INTERMEDIARIO_ERRATO`

        - `PAA_STAZIONE_INT_ERRATA`

        - `PAA_ATTIVA_RPT_IMPORTO_NON_VALIDO`

        - `PPT_ERRORE_EMESSO_DA_PAA`

        - `PAA_SYSTEM_ERROR`
      enum:
        - PPT_STAZIONE_INT_PA_IRRAGGIUNGIBILE
        - PPT_STAZIONE_INT_PA_TIMEOUT
        - PPT_STAZIONE_INT_PA_ERRORE_RESPONSE
        - PPT_IBAN_NON_CENSITO
        - PAA_SINTASSI_EXTRAXSD
        - PAA_SINTASSI_XSD
        - PAA_ID_DOMINIO_ERRATO
        - PAA_ID_INTERMEDIARIO_ERRATO
        - PAA_STAZIONE_INT_ERRATA
        - PAA_ATTIVA_RPT_IMPORTO_NON_VALIDO
        - PPT_ERRORE_EMESSO_DA_PAA
        - PAA_SYSTEM_ERROR
    PaymentInfoNotFoundResponse:
      allOf:
        - $ref: '#/components/schemas/ValidationFaultPaymentDataErrorProblemJson'
        - $ref: '#/components/schemas/ValidationFaultPaymentUnknownProblemJson'
      x-one-of: true
    PaymentInfoConflictResponse:
      allOf:
        - $ref: '#/components/schemas/PaymentOngoingStatusFaultPaymentProblemJson'
        - $ref: '#/components/schemas/PaymentExpiredStatusFaultPaymentProblemJson'
        - $ref: '#/components/schemas/PaymentCanceledStatusFaultPaymentProblemJson'
        - $ref: '#/components/schemas/PaymentDuplicatedStatusFaultPaymentProblemJson'
      x-one-of: true
    PaymentInfoBadGatewayResponse:
      allOf:
        - $ref: '#/components/schemas/GatewayFaultPaymentProblemJson'
        - $ref: '#/components/schemas/ValidationFaultPaymentUnavailableProblemJson'
      x-one-of: true
    PartyConfigurationFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - DOMAIN_UNKNOWN
        faultCodeDetail:
          $ref: '#/components/schemas/PartyConfigurationFault'
      description: A PaymentProblemJson-like type specific for the GetPayment
    ValidationFaultPaymentUnknownProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_UNKNOWN
        faultCodeDetail:
          $ref: '#/components/schemas/ValidationFaultPaymentUnknown'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to
        validation errors.
    ValidationFaultPaymentUnavailableProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_UNAVAILABLE
        faultCodeDetail:
          $ref: '#/components/schemas/ValidationFaultPaymentUnavailable'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to
        validation errors.
    ValidationFaultPaymentDataErrorProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_DATA_ERROR
        faultCodeDetail:
          $ref: '#/components/schemas/ValidationFaultPaymentDataError'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to
        validation errors.
    PaymentOngoingStatusFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_ONGOING
        faultCodeDetail:
          $ref: '#/components/schemas/PaymentOngoingStatusFault'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment and
        ActivatePayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to Nodo
        errors related to payment status conflicts.
    PaymentExpiredStatusFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_EXPIRED
        faultCodeDetail:
          $ref: '#/components/schemas/PaymentExpiredStatusFault'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment and
        ActivatePayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to Nodo
        errors related to payment status conflicts.
    PaymentCanceledStatusFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_CANCELED
        faultCodeDetail:
          $ref: '#/components/schemas/PaymentCanceledStatusFault'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment and
        ActivatePayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to Nodo
        errors related to payment status conflicts.
    PaymentDuplicatedStatusFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - PAYMENT_DUPLICATED
        faultCodeDetail:
          $ref: '#/components/schemas/PaymentDuplicatedStatusFault'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment and
        ActivatePayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to Nodo
        errors related to payment status conflicts.
    GatewayFaultPaymentProblemJson:
      required:
        - faultCodeCategory
        - faultCodeDetail
      type: object
      properties:
        title:
          type: string
          description: >
            A short, summary of the problem type. Written in english and
            readable

            for engineers (usually not suited for non technical stakeholders and

            not localized); example: Service Unavailable
        faultCodeCategory:
          type: string
          enum:
            - GENERIC_ERROR
        faultCodeDetail:
          $ref: '#/components/schemas/GatewayFault'
      description: >
        A PaymentProblemJson-like type specific for the GetPayment and
        ActivatePayment operations.

        Possible values of `detail_v2` are limited to faults pertaining to Nodo
        errors.
    InstallationID:
      type: string
      minLength: 1
      description: >-
        The sixteen octets of an Installation ID are represented as 32
        hexadecimal (base 16) digits, displayed in five groups

        separated by hyphens, in the form 8-4-4-4-12 for a total of 36
        characters (32 alphanumeric characters and four

        hyphens).

        See https://en.wikipedia.org/wiki/Universally_unique_identifier
    InvalidThirdPartyMessageType:
      type: string
      x-extensible-enum:
        - ATTACHMENTS_NOT_PRESENT
        - REMOTE_CONTENT_NOT_PRESENT
        - MARKDOWN_VALIDATION_ERROR
        - SUBJECT_VALIDATION_ERROR
      description: A representation of all the error type for an invalid ThirdPartyMessage
      example: ATTACHMENTS_NOT_PRESENT
    SendActivation:
      type: object
      properties:
        activation_status:
          type: boolean
      required:
        - activation_status
  securitySchemes:
    Bearer:
      type: apiKey
      name: Authorization
      in: header
