swagger: '2.0'
info:
  title: Third Party Messages - Server implementation
  version: 9.7.0
basePath: /
schemes:
  - https
paths:
  /messages/{id}:
    get:
      operationId: getThirdPartyMessageDetails
      summary: Retrieve a Third Party message
      description: |-
        Returns the Third Party message with the provided message ID.
        User's fiscal code is required as header parameter.
      produces:
        - application/json
      parameters:
        - $ref: '#/parameters/FiscalCode'
        - $ref: '#/parameters/ThirdPartyMessageId'
      responses:
        '200':
          description: Found
          schema:
            $ref: '#/definitions/ThirdPartyMessage'
          examples:
            text/json: |
              attachments: [], 
              custom_property: "a custom property" 
              custom_property_2: 42 
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/ProblemJson'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: No message found for the provided ID.
          schema:
            $ref: '#/definitions/ProblemJson'
        '429':
          description: Too Many Requests
        '500':
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ProblemJson'
  /messages/{id}/{attachment_url}:
    get:
      operationId: getThirdPartyMessageAttachment
      summary: Retrieve an attachment of a Third Party message
      description: |-
        Returns the Third Party message with the provided message ID.
        User's fiscal code is required as header parameter.
      produces:
        - application/octet-stream
      parameters:
        - $ref: '#/parameters/FiscalCode'
        - $ref: '#/parameters/ThirdPartyMessageId'
        - name: attachment_url
          in: path
          type: string
          minLength: 1
          required: true
      responses:
        '200':
          description: Success
          schema:
            type: string
            format: binary
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/ProblemJson'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: >-
            No message found for the provided ID or no attachment found at the
            provided url.
          schema:
            $ref: '#/definitions/ProblemJson'
        '429':
          description: Too Many Requests
        '500':
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ProblemJson'

  /messages/{id}/precondition:
    get:
      tags:
      - AppIO-PN-Notification
      parameters:
        - $ref: '#/parameters/FiscalCode'
        - $ref: '#/parameters/ThirdPartyMessageId'
      operationId: getThirdPartyMessagePrecontition
      responses:
        '200':
          description: OK
          schema:
            $ref: "#/definitions/PreconditionContent"
        '400':
          description: Bad Request
          schema:
            $ref: '#/definitions/ProblemJson'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: >-
            No message or precondition found for the provided ID.
          schema:
            $ref: '#/definitions/ProblemJson'
        '429':
          description: Too Many Requests
        '500':
          description: Internal Server Error
          schema:
            $ref: '#/definitions/ProblemJson'

parameters:
  FiscalCode:
    name: fiscal_code
    in: header
    type: string
    maxLength: 16
    minLength: 16
    required: true
    description: The fiscal code of the user, all upper case.
    pattern: >-
      [A-Z]{6}[0-9LMNPQRSTUV]{2}[ABCDEHLMPRST][0-9LMNPQRSTUV]{2}[A-Z][0-9LMNPQRSTUV]{3}[A-Z]
  ThirdPartyMessageId:
    name: id
    in: path
    type: string
    minLength: 1
    required: true
    description: ID of the Third Party message.
definitions:
  PreconditionContent:
    type: object
    properties:
      title:
        type: string
        description: The title to be rendered in App
        minlength: 1
      markdown:
        type: string
        description: The markdown content to be rendered in App
        minlength: 1
    required:
      - title
      - markdown
  ThirdPartyMessage:
    type: object
    properties:
      attachments:
        type: array
        items:
          $ref: '#/definitions/ThirdPartyAttachment'
      details:
        type: object
        additionalProperties: true
  ThirdPartyAttachment:
    type: object
    properties:
      id:
        type: string
        minLength: 1
      content_type:
        type: string
        minLength: 1
      name:
        type: string
        minLength: 1
      url:
        type: string
        minLength: 1
    required:
      - id
      - url
  ProblemJson:
    type: object
    properties:
      type:
        type: string
        format: uri
        description: |-
          An absolute URI that identifies the problem type. When dereferenced,
          it SHOULD provide human-readable documentation for the problem type
          (e.g., using HTML).
        default: about:blank
        example: https://example.com/problem/constraint-violation
      title:
        type: string
        description: |-
          A short, summary of the problem type. Written in english and readable
          for engineers (usually not suited for non technical stakeholders and
          not localized); example: Service Unavailable
      status:
        type: integer
        format: int32
        description: >-
          The HTTP status code generated by the origin server for this
          occurrence

          of the problem.
        minimum: 100
        maximum: 600
        exclusiveMaximum: true
        example: 200
      detail:
        type: string
        description: |-
          A human readable explanation specific to this occurrence of the
          problem.
        example: There was an error processing the request
      instance:
        type: string
        format: uri
        description: >-
          An absolute URI that identifies the specific occurrence of the
          problem.

          It may or may not yield further information if dereferenced.
