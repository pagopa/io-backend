<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="458px" preserveAspectRatio="none" style="width:997px;height:458px;" version="1.1" viewBox="0 0 997 458" width="997px" zoomAndPan="magnify"><defs><filter height="300%" id="f1n49fvra2ukos" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="30" x2="30" y1="38.2969" y2="417.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="487" x2="487" y1="38.2969" y2="417.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="813" x2="813" y1="38.2969" y2="417.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="970" x2="970" y1="38.2969" y2="417.7578"/><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="22.9951">App</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="8" y="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="15" y="436.7529">App</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="460" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="467" y="22.9951">Proxy</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="460" y="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="467" y="436.7529">Proxy</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="793" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="800" y="22.9951">IDP</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="793" y="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="800" y="436.7529">IDP</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="951" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="958" y="22.9951">API</text><rect fill="#FEFECE" filter="url(#f1n49fvra2ukos)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="951" y="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="958" y="436.7529">API</text><polygon fill="#A80036" points="475.5,65.2969,485.5,69.2969,475.5,73.2969,479.5,69.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="481.5" y1="69.2969" y2="69.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="37.5" y="64.3638">GET /login?entityID=idp_entity_id</text><polygon fill="#A80036" points="801.5,94.4297,811.5,98.4297,801.5,102.4297,805.5,98.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="807.5" y1="98.4297" y2="98.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="494.5" y="93.4966">HTTP redirect to IDP entryPoint</text><polygon fill="#A80036" points="498.5,123.5625,488.5,127.5625,498.5,131.5625,494.5,127.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="492.5" x2="812.5" y1="127.5625" y2="127.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="504.5" y="122.6294">POST /assertionConsumerService</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="529.5" y1="156.8281" y2="156.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="529.5" y1="156.8281" y2="169.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="488.5" x2="529.5" y1="169.8281" y2="169.8281"/><polygon fill="#A80036" points="498.5,165.8281,488.5,169.8281,498.5,173.8281,494.5,169.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="494.5" y="151.7622">Generate a unique token</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="529.5" y1="198.9609" y2="198.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="529.5" y1="198.9609" y2="211.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="488.5" x2="529.5" y1="211.9609" y2="211.9609"/><polygon fill="#A80036" points="498.5,207.9609,488.5,211.9609,498.5,215.9609,494.5,211.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="494.5" y="193.895">Generate the user session related with the token</text><polygon fill="#A80036" points="41.5,236.9609,31.5,240.9609,41.5,244.9609,37.5,240.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="486.5" y1="240.9609" y2="240.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="47.5" y="236.0278">HTTP redirect to CLIENT_REDIRECTION_URL with token in querystring</text><polygon fill="#A80036" points="475.5,266.0938,485.5,270.0938,475.5,274.0938,479.5,270.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="30.5" x2="481.5" y1="270.0938" y2="270.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="37.5" y="265.1606">GET /api/v1/profile with Bearer token</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="529.5" y1="299.3594" y2="299.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="529.5" y1="299.3594" y2="312.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="488.5" x2="529.5" y1="312.3594" y2="312.3594"/><polygon fill="#A80036" points="498.5,308.3594,488.5,312.3594,498.5,316.3594,494.5,312.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="494.5" y="294.2935">Use the token to retrieve the user session</text><polygon fill="#A80036" points="958.5,337.3594,968.5,341.3594,958.5,345.3594,962.5,341.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="964.5" y1="341.3594" y2="341.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="494.5" y="336.4263">GET /api/v1/profiles/{fiscal_code} with Ocp-Apim-Subscription-Key token</text><polygon fill="#A80036" points="498.5,366.4922,488.5,370.4922,498.5,374.4922,494.5,370.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="492.5" x2="969.5" y1="370.4922" y2="370.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="504.5" y="365.5591">return json</text><polygon fill="#A80036" points="41.5,395.625,31.5,399.625,41.5,403.625,37.5,399.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35.5" x2="486.5" y1="399.625" y2="399.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="47.5" y="394.6919">return json</text><!--
@startuml
App -> Proxy: GET /login?entityID=idp_entity_id

Proxy -> IDP: HTTP redirect to IDP entryPoint

IDP -> Proxy: POST /assertionConsumerService

Proxy -> Proxy: Generate a unique token

Proxy -> Proxy: Generate the user session related with the token

Proxy -> App: HTTP redirect to CLIENT_REDIRECTION_URL with token in querystring

App -> Proxy: GET /api/v1/profile with Bearer token

Proxy -> Proxy: Use the token to retrieve the user session

Proxy -> API: GET /api/v1/profiles/{fiscal_code} with Ocp-Apim-Subscription-Key token

API -> Proxy: return json 

Proxy -> App: return json
@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>